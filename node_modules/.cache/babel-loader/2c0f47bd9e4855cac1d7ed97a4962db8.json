{"ast":null,"code":"var _get = require(\"C:\\\\Users\\\\Uporabnik\\\\Desktop\\\\macka_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/get\");\nvar _possibleConstructorReturn = require(\"C:\\\\Users\\\\Uporabnik\\\\Desktop\\\\macka_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"C:\\\\Users\\\\Uporabnik\\\\Desktop\\\\macka_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/getPrototypeOf\");\nvar _inherits = require(\"C:\\\\Users\\\\Uporabnik\\\\Desktop\\\\macka_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\nvar _classCallCheck = require(\"C:\\\\Users\\\\Uporabnik\\\\Desktop\\\\macka_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\nvar _createClass = require(\"C:\\\\Users\\\\Uporabnik\\\\Desktop\\\\macka_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e18) { throw _e18; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e19) { didErr = true; err = _e19; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\n!function (t, e) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? e(exports) : \"function\" == typeof define && define.amd ? define([\"exports\"], e) : e((t = t || self).St = {});\n}(this, function (t) {\n  \"use strict\";\n\n  var e = /*#__PURE__*/function () {\n    function e(t, _e) {\n      _classCallCheck(this, e);\n      this.state = {\n        angle: 0,\n        area: [],\n        position: {\n          x: 0,\n          y: 0\n        },\n        hardAngle: 0,\n        hardDrawingAngle: 0\n      }, this.createdDensity = _e, this.nowDrawingDensity = this.createdDensity, this.render = t;\n    }\n    _createClass(e, [{\n      key: \"setDensity\",\n      value: function setDensity(t) {\n        this.createdDensity = t, this.nowDrawingDensity = t;\n      }\n    }, {\n      key: \"setDrawingDensity\",\n      value: function setDrawingDensity(t) {\n        this.nowDrawingDensity = t;\n      }\n    }, {\n      key: \"setPosition\",\n      value: function setPosition(t) {\n        this.state.position = t;\n      }\n    }, {\n      key: \"setAngle\",\n      value: function setAngle(t) {\n        this.state.angle = t;\n      }\n    }, {\n      key: \"setArea\",\n      value: function setArea(t) {\n        this.state.area = t;\n      }\n    }, {\n      key: \"setHardDrawingAngle\",\n      value: function setHardDrawingAngle(t) {\n        this.state.hardDrawingAngle = t;\n      }\n    }, {\n      key: \"setHardAngle\",\n      value: function setHardAngle(t) {\n        this.state.hardAngle = t, this.state.hardDrawingAngle = t;\n      }\n    }, {\n      key: \"setOrientation\",\n      value: function setOrientation(t) {\n        this.orientation = t;\n      }\n    }, {\n      key: \"getDrawingDensity\",\n      value: function getDrawingDensity() {\n        return this.nowDrawingDensity;\n      }\n    }, {\n      key: \"getDensity\",\n      value: function getDensity() {\n        return this.createdDensity;\n      }\n    }, {\n      key: \"getHardAngle\",\n      value: function getHardAngle() {\n        return this.state.hardAngle;\n      }\n    }]);\n    return e;\n  }();\n  var i = /*#__PURE__*/function (_e2) {\n    _inherits(i, _e2);\n    function i(t, e, _i) {\n      var _this;\n      _classCallCheck(this, i);\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(i).call(this, t, _i)), _this.image = null, _this.isLoad = !1, _this.loadingAngle = 0, _this.image = new Image(), _this.image.src = e;\n      return _this;\n    }\n    _createClass(i, [{\n      key: \"draw\",\n      value: function draw(t) {\n        var e = this.render.getContext(),\n          i = this.render.convertToGlobal(this.state.position),\n          s = this.render.getRect().pageWidth,\n          n = this.render.getRect().height;\n        e.save(), e.translate(i.x, i.y), e.beginPath();\n        var _iterator = _createForOfIteratorHelper(this.state.area),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var _t = _step.value;\n            null !== _t && (_t = this.render.convertToGlobal(_t), e.lineTo(_t.x - i.x, _t.y - i.y));\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n        e.rotate(this.state.angle), e.clip(), this.isLoad ? e.drawImage(this.image, 0, 0, s, n) : this.drawLoader(e, {\n          x: 0,\n          y: 0\n        }, s, n), e.restore();\n      }\n    }, {\n      key: \"simpleDraw\",\n      value: function simpleDraw(t) {\n        var e = this.render.getRect(),\n          i = this.render.getContext(),\n          s = e.pageWidth,\n          n = e.height,\n          h = 1 === t ? e.left + e.pageWidth : e.left,\n          r = e.top;\n        this.isLoad ? i.drawImage(this.image, h, r, s, n) : this.drawLoader(i, {\n          x: h,\n          y: r\n        }, s, n);\n      }\n    }, {\n      key: \"drawLoader\",\n      value: function drawLoader(t, e, i, s) {\n        t.beginPath(), t.strokeStyle = \"rgb(200, 200, 200)\", t.fillStyle = \"rgb(255, 255, 255)\", t.lineWidth = 1, t.rect(e.x + 1, e.y + 1, i - 1, s - 1), t.stroke(), t.fill();\n        var n = {\n          x: e.x + i / 2,\n          y: e.y + s / 2\n        };\n        t.beginPath(), t.lineWidth = 10, t.arc(n.x, n.y, 20, this.loadingAngle, 3 * Math.PI / 2 + this.loadingAngle), t.stroke(), t.closePath(), this.loadingAngle += .07, this.loadingAngle >= 2 * Math.PI && (this.loadingAngle = 0);\n      }\n    }, {\n      key: \"load\",\n      value: function load() {\n        var _this2 = this;\n        this.isLoad || (this.image.onload = function () {\n          _this2.isLoad = !0;\n        });\n      }\n    }, {\n      key: \"newTemporaryCopy\",\n      value: function newTemporaryCopy() {\n        return this;\n      }\n    }, {\n      key: \"getTemporaryCopy\",\n      value: function getTemporaryCopy() {\n        return this;\n      }\n    }, {\n      key: \"hideTemporaryCopy\",\n      value: function hideTemporaryCopy() {}\n    }]);\n    return i;\n  }(e);\n  var s = /*#__PURE__*/function () {\n    function s(t, e) {\n      _classCallCheck(this, s);\n      this.pages = [], this.currentPageIndex = 0, this.currentSpreadIndex = 0, this.landscapeSpread = [], this.portraitSpread = [], this.render = e, this.app = t, this.currentPageIndex = 0, this.isShowCover = this.app.getSettings().showCover;\n    }\n    _createClass(s, [{\n      key: \"destroy\",\n      value: function destroy() {\n        this.pages = [];\n      }\n    }, {\n      key: \"createSpread\",\n      value: function createSpread() {\n        this.landscapeSpread = [], this.portraitSpread = [];\n        for (var _t2 = 0; _t2 < this.pages.length; _t2++) this.portraitSpread.push([_t2]);\n        var t = 0;\n        this.isShowCover && (this.pages[0].setDensity(\"hard\"), this.landscapeSpread.push([t]), t++);\n        for (var _e3 = t; _e3 < this.pages.length; _e3 += 2) _e3 < this.pages.length - 1 ? this.landscapeSpread.push([_e3, _e3 + 1]) : (this.landscapeSpread.push([_e3]), this.pages[_e3].setDensity(\"hard\"));\n      }\n    }, {\n      key: \"getSpread\",\n      value: function getSpread() {\n        return \"landscape\" === this.render.getOrientation() ? this.landscapeSpread : this.portraitSpread;\n      }\n    }, {\n      key: \"getSpreadIndexByPage\",\n      value: function getSpreadIndexByPage(t) {\n        var e = this.getSpread();\n        for (var _i2 = 0; _i2 < e.length; _i2++) if (t === e[_i2][0] || t === e[_i2][1]) return _i2;\n        return null;\n      }\n    }, {\n      key: \"getPageCount\",\n      value: function getPageCount() {\n        return this.pages.length;\n      }\n    }, {\n      key: \"getPages\",\n      value: function getPages() {\n        return this.pages;\n      }\n    }, {\n      key: \"getPage\",\n      value: function getPage(t) {\n        if (t >= 0 && t < this.pages.length) return this.pages[t];\n        throw new Error(\"Invalid page number\");\n      }\n    }, {\n      key: \"nextBy\",\n      value: function nextBy(t) {\n        var e = this.pages.indexOf(t);\n        return e < this.pages.length - 1 ? this.pages[e + 1] : null;\n      }\n    }, {\n      key: \"prevBy\",\n      value: function prevBy(t) {\n        var e = this.pages.indexOf(t);\n        return e > 0 ? this.pages[e - 1] : null;\n      }\n    }, {\n      key: \"getFlippingPage\",\n      value: function getFlippingPage(t) {\n        var e = this.currentSpreadIndex;\n        if (\"portrait\" === this.render.getOrientation()) return 0 === t ? this.pages[e].newTemporaryCopy() : this.pages[e - 1];\n        {\n          var _i3 = 0 === t ? this.getSpread()[e + 1] : this.getSpread()[e - 1];\n          return 1 === _i3.length || 0 === t ? this.pages[_i3[0]] : this.pages[_i3[1]];\n        }\n      }\n    }, {\n      key: \"getBottomPage\",\n      value: function getBottomPage(t) {\n        var e = this.currentSpreadIndex;\n        if (\"portrait\" === this.render.getOrientation()) return 0 === t ? this.pages[e + 1] : this.pages[e - 1];\n        {\n          var _i4 = 0 === t ? this.getSpread()[e + 1] : this.getSpread()[e - 1];\n          return 1 === _i4.length ? this.pages[_i4[0]] : 0 === t ? this.pages[_i4[1]] : this.pages[_i4[0]];\n        }\n      }\n    }, {\n      key: \"showNext\",\n      value: function showNext() {\n        this.currentSpreadIndex < this.getSpread().length && (this.currentSpreadIndex++, this.showSpread());\n      }\n    }, {\n      key: \"showPrev\",\n      value: function showPrev() {\n        this.currentSpreadIndex > 0 && (this.currentSpreadIndex--, this.showSpread());\n      }\n    }, {\n      key: \"getCurrentPageIndex\",\n      value: function getCurrentPageIndex() {\n        return this.currentPageIndex;\n      }\n    }, {\n      key: \"show\",\n      value: function show() {\n        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n        if (null === t && (t = this.currentPageIndex), t < 0 || t >= this.pages.length) return;\n        var e = this.getSpreadIndexByPage(t);\n        null !== e && (this.currentSpreadIndex = e, this.showSpread());\n      }\n    }, {\n      key: \"getCurrentSpreadIndex\",\n      value: function getCurrentSpreadIndex() {\n        return this.currentSpreadIndex;\n      }\n    }, {\n      key: \"setCurrentSpreadIndex\",\n      value: function setCurrentSpreadIndex(t) {\n        if (!(t >= 0 && t < this.getSpread().length)) throw new Error(\"Invalid page\");\n        this.currentSpreadIndex = t;\n      }\n    }, {\n      key: \"showSpread\",\n      value: function showSpread() {\n        var t = this.getSpread()[this.currentSpreadIndex];\n        2 === t.length ? (this.render.setLeftPage(this.pages[t[0]]), this.render.setRightPage(this.pages[t[1]])) : \"landscape\" === this.render.getOrientation() && t[0] === this.pages.length - 1 ? (this.render.setLeftPage(this.pages[t[0]]), this.render.setRightPage(null)) : (this.render.setLeftPage(null), this.render.setRightPage(this.pages[t[0]])), this.currentPageIndex = t[0], this.app.updatePageIndex(this.currentPageIndex);\n      }\n    }]);\n    return s;\n  }();\n  var n = /*#__PURE__*/function (_s) {\n    _inherits(n, _s);\n    function n(t, e, i) {\n      var _this3;\n      _classCallCheck(this, n);\n      _this3 = _possibleConstructorReturn(this, _getPrototypeOf(n).call(this, t, e)), _this3.imagesHref = i;\n      return _this3;\n    }\n    _createClass(n, [{\n      key: \"load\",\n      value: function load() {\n        var _iterator2 = _createForOfIteratorHelper(this.imagesHref),\n          _step2;\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _t3 = _step2.value;\n            var _e4 = new i(this.render, _t3, \"soft\");\n            _e4.load(), this.pages.push(_e4);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n        this.createSpread();\n      }\n    }]);\n    return n;\n  }(s);\n  var h = /*#__PURE__*/function () {\n    function h() {\n      _classCallCheck(this, h);\n    }\n    _createClass(h, null, [{\n      key: \"GetDistanceBetweenTwoPoint\",\n      value: function GetDistanceBetweenTwoPoint(t, e) {\n        return null === t || null === e ? 1 / 0 : Math.sqrt(Math.pow(e.x - t.x, 2) + Math.pow(e.y - t.y, 2));\n      }\n    }, {\n      key: \"GetSegmentLength\",\n      value: function GetSegmentLength(t) {\n        return h.GetDistanceBetweenTwoPoint(t[0], t[1]);\n      }\n    }, {\n      key: \"GetAngleBetweenTwoLine\",\n      value: function GetAngleBetweenTwoLine(t, e) {\n        var i = t[0].y - t[1].y,\n          s = e[0].y - e[1].y,\n          n = t[1].x - t[0].x,\n          h = e[1].x - e[0].x;\n        return Math.acos((i * s + n * h) / (Math.sqrt(i * i + n * n) * Math.sqrt(s * s + h * h)));\n      }\n    }, {\n      key: \"PointInRect\",\n      value: function PointInRect(t, e) {\n        return null === e ? null : e.x >= t.left && e.x <= t.width + t.left && e.y >= t.top && e.y <= t.top + t.height ? e : null;\n      }\n    }, {\n      key: \"GetRotatedPoint\",\n      value: function GetRotatedPoint(t, e, i) {\n        return {\n          x: t.x * Math.cos(i) + t.y * Math.sin(i) + e.x,\n          y: t.y * Math.cos(i) - t.x * Math.sin(i) + e.y\n        };\n      }\n    }, {\n      key: \"LimitPointToCircle\",\n      value: function LimitPointToCircle(t, e, i) {\n        if (h.GetDistanceBetweenTwoPoint(t, i) <= e) return i;\n        var s = t.x,\n          n = t.y,\n          r = i.x,\n          o = i.y;\n        var a = Math.sqrt(Math.pow(e, 2) * Math.pow(s - r, 2) / (Math.pow(s - r, 2) + Math.pow(n - o, 2))) + s;\n        i.x < 0 && (a *= -1);\n        var g = (a - s) * (n - o) / (s - r) + n;\n        return s - r + n === 0 && (g = e), {\n          x: a,\n          y: g\n        };\n      }\n    }, {\n      key: \"GetIntersectBetweenTwoSegment\",\n      value: function GetIntersectBetweenTwoSegment(t, e, i) {\n        return h.PointInRect(t, h.GetIntersectBeetwenTwoLine(e, i));\n      }\n    }, {\n      key: \"GetIntersectBeetwenTwoLine\",\n      value: function GetIntersectBeetwenTwoLine(t, e) {\n        var i = t[0].y - t[1].y,\n          s = e[0].y - e[1].y,\n          n = t[1].x - t[0].x,\n          h = e[1].x - e[0].x,\n          r = t[0].x * t[1].y - t[1].x * t[0].y,\n          o = e[0].x * e[1].y - e[1].x * e[0].y,\n          a = i * o - s * r,\n          g = n * o - h * r,\n          l = -(r * h - o * n) / (i * h - s * n),\n          d = -(i * o - s * r) / (i * h - s * n);\n        if (isFinite(l) && isFinite(d)) return {\n          x: l,\n          y: d\n        };\n        if (Math.abs(a - g) < .1) throw new Error(\"Segment included\");\n        return null;\n      }\n    }, {\n      key: \"GetCordsFromTwoPoint\",\n      value: function GetCordsFromTwoPoint(t, e) {\n        var i = Math.abs(t.x - e.x),\n          s = Math.abs(t.y - e.y),\n          n = Math.max(i, s),\n          h = [t];\n        function r(t, e, i, s, n) {\n          return e > t ? t + n * (i / s) : e < t ? t - n * (i / s) : t;\n        }\n        for (var _o = 1; _o <= n; _o += 1) h.push({\n          x: r(t.x, e.x, i, n, _o),\n          y: r(t.y, e.y, s, n, _o)\n        });\n        return h;\n      }\n    }]);\n    return h;\n  }();\n  var r = /*#__PURE__*/function (_e5) {\n    _inherits(r, _e5);\n    function r(t, e, i) {\n      var _this4;\n      _classCallCheck(this, r);\n      _this4 = _possibleConstructorReturn(this, _getPrototypeOf(r).call(this, t, i)), _this4.copiedElement = null, _this4.temporaryCopy = null, _this4.isLoad = !1, _this4.element = e, _this4.element.classList.add(\"stf__item\"), _this4.element.classList.add(\"--\" + i);\n      return _this4;\n    }\n    _createClass(r, [{\n      key: \"newTemporaryCopy\",\n      value: function newTemporaryCopy() {\n        return \"hard\" === this.nowDrawingDensity ? this : (null === this.temporaryCopy && (this.copiedElement = this.element.cloneNode(!0), this.element.parentElement.appendChild(this.copiedElement), this.temporaryCopy = new r(this.render, this.copiedElement, this.nowDrawingDensity)), this.getTemporaryCopy());\n      }\n    }, {\n      key: \"getTemporaryCopy\",\n      value: function getTemporaryCopy() {\n        return this.temporaryCopy;\n      }\n    }, {\n      key: \"hideTemporaryCopy\",\n      value: function hideTemporaryCopy() {\n        null !== this.temporaryCopy && (this.copiedElement.remove(), this.copiedElement = null, this.temporaryCopy = null);\n      }\n    }, {\n      key: \"draw\",\n      value: function draw(t) {\n        var e = t || this.nowDrawingDensity,\n          i = this.render.convertToGlobal(this.state.position),\n          s = this.render.getRect().pageWidth,\n          n = this.render.getRect().height;\n        this.element.classList.remove(\"--simple\");\n        var h = \"\\n            display: block;\\n            z-index: \".concat(this.element.style.zIndex, \";\\n            left: 0;\\n            top: 0;\\n            width: \").concat(s, \"px;\\n            height: \").concat(n, \"px;\\n        \");\n        \"hard\" === e ? this.drawHard(h) : this.drawSoft(i, h);\n      }\n    }, {\n      key: \"drawHard\",\n      value: function drawHard() {\n        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n        var e = this.render.getRect().left + this.render.getRect().width / 2,\n          i = this.state.hardDrawingAngle,\n          s = t + \"\\n                backface-visibility: hidden;\\n                -webkit-backface-visibility: hidden;\\n                clip-path: none;\\n                -webkit-clip-path: none;\\n            \" + (0 === this.orientation ? \"transform-origin: \".concat(this.render.getRect().pageWidth, \"px 0; \\n                   transform: translate3d(0, 0, 0) rotateY(\").concat(i, \"deg);\") : \"transform-origin: 0 0; \\n                   transform: translate3d(\".concat(e, \"px, 0, 0) rotateY(\").concat(i, \"deg);\"));\n        this.element.style.cssText = s;\n      }\n    }, {\n      key: \"drawSoft\",\n      value: function drawSoft(t) {\n        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"\";\n        var i = \"polygon( \";\n        var _iterator3 = _createForOfIteratorHelper(this.state.area),\n          _step3;\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var _t4 = _step3.value;\n            if (null !== _t4) {\n              var _e6 = 1 === this.render.getDirection() ? {\n                x: -_t4.x + this.state.position.x,\n                y: _t4.y - this.state.position.y\n              } : {\n                x: _t4.x - this.state.position.x,\n                y: _t4.y - this.state.position.y\n              };\n              _e6 = h.GetRotatedPoint(_e6, {\n                x: 0,\n                y: 0\n              }, this.state.angle), i += _e6.x + \"px \" + _e6.y + \"px, \";\n            }\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n        i = i.slice(0, -2), i += \")\";\n        var s = e + \"transform-origin: 0 0; clip-path: \".concat(i, \"; -webkit-clip-path: \").concat(i, \";\") + (this.render.isSafari() && 0 === this.state.angle ? \"transform: translate(\".concat(t.x, \"px, \").concat(t.y, \"px);\") : \"transform: translate3d(\".concat(t.x, \"px, \").concat(t.y, \"px, 0) rotate(\").concat(this.state.angle, \"rad);\"));\n        this.element.style.cssText = s;\n      }\n    }, {\n      key: \"simpleDraw\",\n      value: function simpleDraw(t) {\n        var e = this.render.getRect(),\n          i = e.pageWidth,\n          s = e.height,\n          n = 1 === t ? e.left + e.pageWidth : e.left,\n          h = e.top;\n        this.element.classList.add(\"--simple\"), this.element.style.cssText = \"\\n            position: absolute; \\n            display: block; \\n            height: \".concat(s, \"px; \\n            left: \").concat(n, \"px; \\n            top: \").concat(h, \"px; \\n            width: \").concat(i, \"px; \\n            z-index: \").concat(this.render.getSettings().startZIndex + 1, \";\");\n      }\n    }, {\n      key: \"getElement\",\n      value: function getElement() {\n        return this.element;\n      }\n    }, {\n      key: \"load\",\n      value: function load() {\n        this.isLoad = !0;\n      }\n    }, {\n      key: \"setOrientation\",\n      value: function setOrientation(t) {\n        _get(_getPrototypeOf(r.prototype), \"setOrientation\", this).call(this, t), this.element.classList.remove(\"--left\", \"--right\"), this.element.classList.add(1 === t ? \"--right\" : \"--left\");\n      }\n    }, {\n      key: \"setDrawingDensity\",\n      value: function setDrawingDensity(t) {\n        this.element.classList.remove(\"--soft\", \"--hard\"), this.element.classList.add(\"--\" + t), _get(_getPrototypeOf(r.prototype), \"setDrawingDensity\", this).call(this, t);\n      }\n    }]);\n    return r;\n  }(e);\n  var o = /*#__PURE__*/function (_s2) {\n    _inherits(o, _s2);\n    function o(t, e, i, s) {\n      var _this5;\n      _classCallCheck(this, o);\n      _this5 = _possibleConstructorReturn(this, _getPrototypeOf(o).call(this, t, e)), _this5.element = i, _this5.pagesElement = s;\n      return _this5;\n    }\n    _createClass(o, [{\n      key: \"load\",\n      value: function load() {\n        var _iterator4 = _createForOfIteratorHelper(this.pagesElement),\n          _step4;\n        try {\n          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n            var _t5 = _step4.value;\n            var _e7 = new r(this.render, _t5, \"hard\" === _t5.dataset.density ? \"hard\" : \"soft\");\n            _e7.load(), this.pages.push(_e7);\n          }\n        } catch (err) {\n          _iterator4.e(err);\n        } finally {\n          _iterator4.f();\n        }\n        this.createSpread();\n      }\n    }]);\n    return o;\n  }(s);\n  var a = /*#__PURE__*/function () {\n    function a(t, e, i, s) {\n      _classCallCheck(this, a);\n      this.direction = t, this.corner = e, this.topIntersectPoint = null, this.sideIntersectPoint = null, this.bottomIntersectPoint = null, this.pageWidth = parseInt(i, 10), this.pageHeight = parseInt(s, 10);\n    }\n    _createClass(a, [{\n      key: \"calc\",\n      value: function calc(t) {\n        try {\n          return this.position = this.calcAngleAndPosition(t), this.calculateIntersectPoint(this.position), !0;\n        } catch (t) {\n          return !1;\n        }\n      }\n    }, {\n      key: \"getFlippingClipArea\",\n      value: function getFlippingClipArea() {\n        var t = [];\n        var e = !1;\n        return t.push(this.rect.topLeft), t.push(this.topIntersectPoint), null === this.sideIntersectPoint ? e = !0 : (t.push(this.sideIntersectPoint), null === this.bottomIntersectPoint && (e = !1)), t.push(this.bottomIntersectPoint), (e || \"bottom\" === this.corner) && t.push(this.rect.bottomLeft), t;\n      }\n    }, {\n      key: \"getBottomClipArea\",\n      value: function getBottomClipArea() {\n        var t = [];\n        return t.push(this.topIntersectPoint), \"top\" === this.corner ? t.push({\n          x: this.pageWidth,\n          y: 0\n        }) : (null !== this.topIntersectPoint && t.push({\n          x: this.pageWidth,\n          y: 0\n        }), t.push({\n          x: this.pageWidth,\n          y: this.pageHeight\n        })), null !== this.sideIntersectPoint ? h.GetDistanceBetweenTwoPoint(this.sideIntersectPoint, this.topIntersectPoint) >= 10 && t.push(this.sideIntersectPoint) : \"top\" === this.corner && t.push({\n          x: this.pageWidth,\n          y: this.pageHeight\n        }), t.push(this.bottomIntersectPoint), t.push(this.topIntersectPoint), t;\n      }\n    }, {\n      key: \"getAngle\",\n      value: function getAngle() {\n        return 0 === this.direction ? -this.angle : this.angle;\n      }\n    }, {\n      key: \"getRect\",\n      value: function getRect() {\n        return this.rect;\n      }\n    }, {\n      key: \"getPosition\",\n      value: function getPosition() {\n        return this.position;\n      }\n    }, {\n      key: \"getActiveCorner\",\n      value: function getActiveCorner() {\n        return 0 === this.direction ? this.rect.topLeft : this.rect.topRight;\n      }\n    }, {\n      key: \"getDirection\",\n      value: function getDirection() {\n        return this.direction;\n      }\n    }, {\n      key: \"getFlippingProgress\",\n      value: function getFlippingProgress() {\n        return Math.abs((this.position.x - this.pageWidth) / (2 * this.pageWidth) * 100);\n      }\n    }, {\n      key: \"getCorner\",\n      value: function getCorner() {\n        return this.corner;\n      }\n    }, {\n      key: \"getBottomPagePosition\",\n      value: function getBottomPagePosition() {\n        return 1 === this.direction ? {\n          x: this.pageWidth,\n          y: 0\n        } : {\n          x: 0,\n          y: 0\n        };\n      }\n    }, {\n      key: \"getShadowStartPoint\",\n      value: function getShadowStartPoint() {\n        return \"top\" === this.corner ? this.topIntersectPoint : null !== this.sideIntersectPoint ? this.sideIntersectPoint : this.topIntersectPoint;\n      }\n    }, {\n      key: \"getShadowAngle\",\n      value: function getShadowAngle() {\n        var t = h.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(), [{\n          x: 0,\n          y: 0\n        }, {\n          x: this.pageWidth,\n          y: 0\n        }]);\n        return 0 === this.direction ? t : Math.PI - t;\n      }\n    }, {\n      key: \"calcAngleAndPosition\",\n      value: function calcAngleAndPosition(t) {\n        var e = t;\n        if (this.updateAngleAndGeometry(e), e = \"top\" === this.corner ? this.checkPositionAtCenterLine(e, {\n          x: 0,\n          y: 0\n        }, {\n          x: 0,\n          y: this.pageHeight\n        }) : this.checkPositionAtCenterLine(e, {\n          x: 0,\n          y: this.pageHeight\n        }, {\n          x: 0,\n          y: 0\n        }), Math.abs(e.x - this.pageWidth) < 1 && Math.abs(e.y) < 1) throw new Error(\"Point is too small\");\n        return e;\n      }\n    }, {\n      key: \"updateAngleAndGeometry\",\n      value: function updateAngleAndGeometry(t) {\n        this.angle = this.calculateAngle(t), this.rect = this.getPageRect(t);\n      }\n    }, {\n      key: \"calculateAngle\",\n      value: function calculateAngle(t) {\n        var e = this.pageWidth - t.x + 1,\n          i = \"bottom\" === this.corner ? this.pageHeight - t.y : t.y;\n        var s = 2 * Math.acos(e / Math.sqrt(i * i + e * e));\n        i < 0 && (s = -s);\n        var n = Math.PI - s;\n        if (!isFinite(s) || n >= 0 && n < .003) throw new Error(\"The G point is too small\");\n        return \"bottom\" === this.corner && (s = -s), s;\n      }\n    }, {\n      key: \"getPageRect\",\n      value: function getPageRect(t) {\n        return \"top\" === this.corner ? this.getRectFromBasePoint([{\n          x: 0,\n          y: 0\n        }, {\n          x: this.pageWidth,\n          y: 0\n        }, {\n          x: 0,\n          y: this.pageHeight\n        }, {\n          x: this.pageWidth,\n          y: this.pageHeight\n        }], t) : this.getRectFromBasePoint([{\n          x: 0,\n          y: -this.pageHeight\n        }, {\n          x: this.pageWidth,\n          y: -this.pageHeight\n        }, {\n          x: 0,\n          y: 0\n        }, {\n          x: this.pageWidth,\n          y: 0\n        }], t);\n      }\n    }, {\n      key: \"getRectFromBasePoint\",\n      value: function getRectFromBasePoint(t, e) {\n        return {\n          topLeft: this.getRotatedPoint(t[0], e),\n          topRight: this.getRotatedPoint(t[1], e),\n          bottomLeft: this.getRotatedPoint(t[2], e),\n          bottomRight: this.getRotatedPoint(t[3], e)\n        };\n      }\n    }, {\n      key: \"getRotatedPoint\",\n      value: function getRotatedPoint(t, e) {\n        return {\n          x: t.x * Math.cos(this.angle) + t.y * Math.sin(this.angle) + e.x,\n          y: t.y * Math.cos(this.angle) - t.x * Math.sin(this.angle) + e.y\n        };\n      }\n    }, {\n      key: \"calculateIntersectPoint\",\n      value: function calculateIntersectPoint(t) {\n        var e = {\n          left: -1,\n          top: -1,\n          width: this.pageWidth + 2,\n          height: this.pageHeight + 2\n        };\n        \"top\" === this.corner ? (this.topIntersectPoint = h.GetIntersectBetweenTwoSegment(e, [t, this.rect.topRight], [{\n          x: 0,\n          y: 0\n        }, {\n          x: this.pageWidth,\n          y: 0\n        }]), this.sideIntersectPoint = h.GetIntersectBetweenTwoSegment(e, [t, this.rect.bottomLeft], [{\n          x: this.pageWidth,\n          y: 0\n        }, {\n          x: this.pageWidth,\n          y: this.pageHeight\n        }]), this.bottomIntersectPoint = h.GetIntersectBetweenTwoSegment(e, [this.rect.bottomLeft, this.rect.bottomRight], [{\n          x: 0,\n          y: this.pageHeight\n        }, {\n          x: this.pageWidth,\n          y: this.pageHeight\n        }])) : (this.topIntersectPoint = h.GetIntersectBetweenTwoSegment(e, [this.rect.topLeft, this.rect.topRight], [{\n          x: 0,\n          y: 0\n        }, {\n          x: this.pageWidth,\n          y: 0\n        }]), this.sideIntersectPoint = h.GetIntersectBetweenTwoSegment(e, [t, this.rect.topLeft], [{\n          x: this.pageWidth,\n          y: 0\n        }, {\n          x: this.pageWidth,\n          y: this.pageHeight\n        }]), this.bottomIntersectPoint = h.GetIntersectBetweenTwoSegment(e, [this.rect.bottomLeft, this.rect.bottomRight], [{\n          x: 0,\n          y: this.pageHeight\n        }, {\n          x: this.pageWidth,\n          y: this.pageHeight\n        }]));\n      }\n    }, {\n      key: \"checkPositionAtCenterLine\",\n      value: function checkPositionAtCenterLine(t, e, i) {\n        var s = t;\n        var n = h.LimitPointToCircle(e, this.pageWidth, s);\n        s !== n && (s = n, this.updateAngleAndGeometry(s));\n        var r = Math.sqrt(Math.pow(this.pageWidth, 2) + Math.pow(this.pageHeight, 2));\n        var o = this.rect.bottomRight,\n          a = this.rect.topLeft;\n        if (\"bottom\" === this.corner && (o = this.rect.topRight, a = this.rect.bottomLeft), o.x <= 0) {\n          var _t6 = h.LimitPointToCircle(i, r, a);\n          _t6 !== s && (s = _t6, this.updateAngleAndGeometry(s));\n        }\n        return s;\n      }\n    }, {\n      key: \"getSegmentToShadowLine\",\n      value: function getSegmentToShadowLine() {\n        var t = this.getShadowStartPoint();\n        return [t, t !== this.sideIntersectPoint && null !== this.sideIntersectPoint ? this.sideIntersectPoint : this.bottomIntersectPoint];\n      }\n    }]);\n    return a;\n  }();\n  var g = /*#__PURE__*/function () {\n    function g(t, e) {\n      _classCallCheck(this, g);\n      this.flippingPage = null, this.bottomPage = null, this.calc = null, this.state = \"read\", this.render = t, this.app = e;\n    }\n    _createClass(g, [{\n      key: \"fold\",\n      value: function fold(t) {\n        this.setState(\"user_fold\"), null === this.calc && this.start(t), this.do(this.render.convertToPage(t));\n      }\n    }, {\n      key: \"flip\",\n      value: function flip(t) {\n        if (this.app.getSettings().disableFlipByClick && !this.isPointOnCorners(t)) return;\n        if (null !== this.calc && this.render.finishAnimation(), !this.start(t)) return;\n        var e = this.getBoundsRect();\n        this.setState(\"flipping\");\n        var i = e.height / 10,\n          s = \"bottom\" === this.calc.getCorner() ? e.height - i : i,\n          n = \"bottom\" === this.calc.getCorner() ? e.height : 0;\n        this.calc.calc({\n          x: e.pageWidth - i,\n          y: s\n        }), this.animateFlippingTo({\n          x: e.pageWidth - i,\n          y: s\n        }, {\n          x: -e.pageWidth,\n          y: n\n        }, !0);\n      }\n    }, {\n      key: \"start\",\n      value: function start(t) {\n        this.reset();\n        var e = this.render.convertToBook(t),\n          i = this.getBoundsRect(),\n          s = this.getDirectionByPoint(e),\n          n = e.y >= i.height / 2 ? \"bottom\" : \"top\";\n        if (!this.checkDirection(s)) return !1;\n        try {\n          if (this.flippingPage = this.app.getPageCollection().getFlippingPage(s), this.bottomPage = this.app.getPageCollection().getBottomPage(s), \"landscape\" === this.render.getOrientation()) if (1 === s) {\n            var _t7 = this.app.getPageCollection().nextBy(this.flippingPage);\n            null !== _t7 && this.flippingPage.getDensity() !== _t7.getDensity() && (this.flippingPage.setDrawingDensity(\"hard\"), _t7.setDrawingDensity(\"hard\"));\n          } else {\n            var _t8 = this.app.getPageCollection().prevBy(this.flippingPage);\n            null !== _t8 && this.flippingPage.getDensity() !== _t8.getDensity() && (this.flippingPage.setDrawingDensity(\"hard\"), _t8.setDrawingDensity(\"hard\"));\n          }\n          return this.render.setDirection(s), this.calc = new a(s, n, i.pageWidth.toString(10), i.height.toString(10)), !0;\n        } catch (t) {\n          return !1;\n        }\n      }\n    }, {\n      key: \"do\",\n      value: function _do(t) {\n        if (null !== this.calc && this.calc.calc(t)) {\n          var _t9 = this.calc.getFlippingProgress();\n          this.bottomPage.setArea(this.calc.getBottomClipArea()), this.bottomPage.setPosition(this.calc.getBottomPagePosition()), this.bottomPage.setAngle(0), this.bottomPage.setHardAngle(0), this.flippingPage.setArea(this.calc.getFlippingClipArea()), this.flippingPage.setPosition(this.calc.getActiveCorner()), this.flippingPage.setAngle(this.calc.getAngle()), 0 === this.calc.getDirection() ? this.flippingPage.setHardAngle(90 * (200 - 2 * _t9) / 100) : this.flippingPage.setHardAngle(-90 * (200 - 2 * _t9) / 100), this.render.setPageRect(this.calc.getRect()), this.render.setBottomPage(this.bottomPage), this.render.setFlippingPage(this.flippingPage), this.render.setShadowData(this.calc.getShadowStartPoint(), this.calc.getShadowAngle(), _t9, this.calc.getDirection());\n        }\n      }\n    }, {\n      key: \"flipToPage\",\n      value: function flipToPage(t, e) {\n        var i = this.app.getPageCollection().getCurrentSpreadIndex(),\n          s = this.app.getPageCollection().getSpreadIndexByPage(t);\n        try {\n          s > i && (this.app.getPageCollection().setCurrentSpreadIndex(s - 1), this.flipNext(e)), s < i && (this.app.getPageCollection().setCurrentSpreadIndex(s + 1), this.flipPrev(e));\n        } catch (t) {}\n      }\n    }, {\n      key: \"flipNext\",\n      value: function flipNext(t) {\n        this.flip({\n          x: this.render.getRect().left + 2 * this.render.getRect().pageWidth - 10,\n          y: \"top\" === t ? 1 : this.render.getRect().height - 2\n        });\n      }\n    }, {\n      key: \"flipPrev\",\n      value: function flipPrev(t) {\n        this.flip({\n          x: 10,\n          y: \"top\" === t ? 1 : this.render.getRect().height - 2\n        });\n      }\n    }, {\n      key: \"stopMove\",\n      value: function stopMove() {\n        if (null === this.calc) return;\n        var t = this.calc.getPosition(),\n          e = this.getBoundsRect(),\n          i = \"bottom\" === this.calc.getCorner() ? e.height : 0;\n        t.x <= 0 ? this.animateFlippingTo(t, {\n          x: -e.pageWidth,\n          y: i\n        }, !0) : this.animateFlippingTo(t, {\n          x: e.pageWidth,\n          y: i\n        }, !1);\n      }\n    }, {\n      key: \"showCorner\",\n      value: function showCorner(t) {\n        if (!this.checkState(\"read\", \"fold_corner\")) return;\n        var e = this.getBoundsRect(),\n          i = e.pageWidth;\n        if (this.isPointOnCorners(t)) {\n          if (null === this.calc) {\n            if (!this.start(t)) return;\n            this.setState(\"fold_corner\"), this.calc.calc({\n              x: i - 1,\n              y: 1\n            });\n            var _s3 = 50,\n              _n = \"bottom\" === this.calc.getCorner() ? e.height - 1 : 1,\n              _h = \"bottom\" === this.calc.getCorner() ? e.height - _s3 : _s3;\n            this.animateFlippingTo({\n              x: i - 1,\n              y: _n\n            }, {\n              x: i - _s3,\n              y: _h\n            }, !1, !1);\n          } else this.do(this.render.convertToPage(t));\n        } else this.setState(\"read\"), this.render.finishAnimation(), this.stopMove();\n      }\n    }, {\n      key: \"animateFlippingTo\",\n      value: function animateFlippingTo(t, e, i) {\n        var _this6 = this;\n        var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !0;\n        var n = h.GetCordsFromTwoPoint(t, e),\n          r = [];\n        var _iterator5 = _createForOfIteratorHelper(n),\n          _step5;\n        try {\n          var _loop = function _loop() {\n            var t = _step5.value;\n            r.push(function () {\n              return _this6.do(t);\n            });\n          };\n          for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n            _loop();\n          }\n        } catch (err) {\n          _iterator5.e(err);\n        } finally {\n          _iterator5.f();\n        }\n        var o = this.getAnimationDuration(n.length);\n        this.render.startAnimation(r, o, function () {\n          _this6.calc && (i && (1 === _this6.calc.getDirection() ? _this6.app.turnToPrevPage() : _this6.app.turnToNextPage()), s && (_this6.render.setBottomPage(null), _this6.render.setFlippingPage(null), _this6.render.clearShadow(), _this6.setState(\"read\"), _this6.reset()));\n        });\n      }\n    }, {\n      key: \"getCalculation\",\n      value: function getCalculation() {\n        return this.calc;\n      }\n    }, {\n      key: \"getState\",\n      value: function getState() {\n        return this.state;\n      }\n    }, {\n      key: \"setState\",\n      value: function setState(t) {\n        this.state !== t && (this.app.updateState(t), this.state = t);\n      }\n    }, {\n      key: \"getDirectionByPoint\",\n      value: function getDirectionByPoint(t) {\n        var e = this.getBoundsRect();\n        if (\"portrait\" === this.render.getOrientation()) {\n          if (t.x - e.pageWidth <= e.width / 5) return 1;\n        } else if (t.x < e.width / 2) return 1;\n        return 0;\n      }\n    }, {\n      key: \"getAnimationDuration\",\n      value: function getAnimationDuration(t) {\n        var e = this.app.getSettings().flippingTime;\n        return t >= 1e3 ? e : t / 1e3 * e;\n      }\n    }, {\n      key: \"checkDirection\",\n      value: function checkDirection(t) {\n        return 0 === t ? this.app.getCurrentPageIndex() < this.app.getPageCount() - 1 : this.app.getCurrentPageIndex() >= 1;\n      }\n    }, {\n      key: \"reset\",\n      value: function reset() {\n        this.calc = null, this.flippingPage = null, this.bottomPage = null;\n      }\n    }, {\n      key: \"getBoundsRect\",\n      value: function getBoundsRect() {\n        return this.render.getRect();\n      }\n    }, {\n      key: \"checkState\",\n      value: function checkState() {\n        for (var _len = arguments.length, t = new Array(_len), _key = 0; _key < _len; _key++) {\n          t[_key] = arguments[_key];\n        }\n        for (var _i5 = 0, _t10 = t; _i5 < _t10.length; _i5++) {\n          var _e8 = _t10[_i5];\n          if (this.state === _e8) return !0;\n        }\n        return !1;\n      }\n    }, {\n      key: \"isPointOnCorners\",\n      value: function isPointOnCorners(t) {\n        var e = this.getBoundsRect(),\n          i = e.pageWidth,\n          s = Math.sqrt(Math.pow(i, 2) + Math.pow(e.height, 2)) / 5,\n          n = this.render.convertToBook(t);\n        return n.x > 0 && n.y > 0 && n.x < e.width && n.y < e.height && (n.x < s || n.x > e.width - s) && (n.y < s || n.y > e.height - s);\n      }\n    }]);\n    return g;\n  }();\n  var l = /*#__PURE__*/function () {\n    function l(t, e) {\n      _classCallCheck(this, l);\n      this.leftPage = null, this.rightPage = null, this.flippingPage = null, this.bottomPage = null, this.direction = null, this.orientation = null, this.shadow = null, this.animation = null, this.pageRect = null, this.boundsRect = null, this.timer = 0, this.safari = !1, this.setting = e, this.app = t;\n      var i = new RegExp(\"Version\\\\/[\\\\d\\\\.]+.*Safari/\");\n      this.safari = null !== i.exec(window.navigator.userAgent);\n    }\n    _createClass(l, [{\n      key: \"render\",\n      value: function render(t) {\n        if (null !== this.animation) {\n          var _e9 = Math.round((t - this.animation.startedAt) / this.animation.durationFrame);\n          _e9 < this.animation.frames.length ? this.animation.frames[_e9]() : (this.animation.onAnimateEnd(), this.animation = null);\n        }\n        this.timer = t, this.drawFrame();\n      }\n    }, {\n      key: \"start\",\n      value: function start() {\n        var _this7 = this;\n        this.update();\n        var t = function t(e) {\n          _this7.render(e), requestAnimationFrame(t);\n        };\n        requestAnimationFrame(t);\n      }\n    }, {\n      key: \"startAnimation\",\n      value: function startAnimation(t, e, i) {\n        this.finishAnimation(), this.animation = {\n          frames: t,\n          duration: e,\n          durationFrame: e / t.length,\n          onAnimateEnd: i,\n          startedAt: this.timer\n        };\n      }\n    }, {\n      key: \"finishAnimation\",\n      value: function finishAnimation() {\n        null !== this.animation && (this.animation.frames[this.animation.frames.length - 1](), null !== this.animation.onAnimateEnd && this.animation.onAnimateEnd()), this.animation = null;\n      }\n    }, {\n      key: \"update\",\n      value: function update() {\n        this.boundsRect = null;\n        var t = this.calculateBoundsRect();\n        this.orientation !== t && (this.orientation = t, this.app.updateOrientation(t));\n      }\n    }, {\n      key: \"calculateBoundsRect\",\n      value: function calculateBoundsRect() {\n        var t = \"landscape\";\n        var e = this.getBlockWidth(),\n          i = e / 2,\n          s = this.getBlockHeight() / 2,\n          n = this.setting.width / this.setting.height;\n        var h = this.setting.width,\n          r = this.setting.height,\n          o = i - h;\n        return \"stretch\" === this.setting.size ? (e < 2 * this.setting.minWidth && this.app.getSettings().usePortrait && (t = \"portrait\"), h = \"portrait\" === t ? this.getBlockWidth() : this.getBlockWidth() / 2, h > this.setting.maxWidth && (h = this.setting.maxWidth), r = h / n, r > this.getBlockHeight() && (r = this.getBlockHeight(), h = r * n), o = \"portrait\" === t ? i - h / 2 - h : i - h) : e < 2 * h && this.app.getSettings().usePortrait && (t = \"portrait\", o = i - h / 2 - h), this.boundsRect = {\n          left: o,\n          top: s - r / 2,\n          width: 2 * h,\n          height: r,\n          pageWidth: h\n        }, t;\n      }\n    }, {\n      key: \"setShadowData\",\n      value: function setShadowData(t, e, i, s) {\n        if (!this.app.getSettings().drawShadow) return;\n        var n = 100 * this.getSettings().maxShadowOpacity;\n        this.shadow = {\n          pos: t,\n          angle: e,\n          width: 3 * this.getRect().pageWidth / 4 * i / 100,\n          opacity: (100 - i) * n / 100 / 100,\n          direction: s,\n          progress: 2 * i\n        };\n      }\n    }, {\n      key: \"clearShadow\",\n      value: function clearShadow() {\n        this.shadow = null;\n      }\n    }, {\n      key: \"getBlockWidth\",\n      value: function getBlockWidth() {\n        return this.app.getUI().getDistElement().offsetWidth;\n      }\n    }, {\n      key: \"getBlockHeight\",\n      value: function getBlockHeight() {\n        return this.app.getUI().getDistElement().offsetHeight;\n      }\n    }, {\n      key: \"getDirection\",\n      value: function getDirection() {\n        return this.direction;\n      }\n    }, {\n      key: \"getRect\",\n      value: function getRect() {\n        return null === this.boundsRect && this.calculateBoundsRect(), this.boundsRect;\n      }\n    }, {\n      key: \"getSettings\",\n      value: function getSettings() {\n        return this.app.getSettings();\n      }\n    }, {\n      key: \"getOrientation\",\n      value: function getOrientation() {\n        return this.orientation;\n      }\n    }, {\n      key: \"setPageRect\",\n      value: function setPageRect(t) {\n        this.pageRect = t;\n      }\n    }, {\n      key: \"setDirection\",\n      value: function setDirection(t) {\n        this.direction = t;\n      }\n    }, {\n      key: \"setRightPage\",\n      value: function setRightPage(t) {\n        null !== t && t.setOrientation(1), this.rightPage = t;\n      }\n    }, {\n      key: \"setLeftPage\",\n      value: function setLeftPage(t) {\n        null !== t && t.setOrientation(0), this.leftPage = t;\n      }\n    }, {\n      key: \"setBottomPage\",\n      value: function setBottomPage(t) {\n        null !== t && t.setOrientation(1 === this.direction ? 0 : 1), this.bottomPage = t;\n      }\n    }, {\n      key: \"setFlippingPage\",\n      value: function setFlippingPage(t) {\n        null !== t && t.setOrientation(0 === this.direction && \"portrait\" !== this.orientation ? 0 : 1), this.flippingPage = t;\n      }\n    }, {\n      key: \"convertToBook\",\n      value: function convertToBook(t) {\n        var e = this.getRect();\n        return {\n          x: t.x - e.left,\n          y: t.y - e.top\n        };\n      }\n    }, {\n      key: \"isSafari\",\n      value: function isSafari() {\n        return this.safari;\n      }\n    }, {\n      key: \"convertToPage\",\n      value: function convertToPage(t, e) {\n        e || (e = this.direction);\n        var i = this.getRect();\n        return {\n          x: 0 === e ? t.x - i.left - i.width / 2 : i.width / 2 - t.x + i.left,\n          y: t.y - i.top\n        };\n      }\n    }, {\n      key: \"convertToGlobal\",\n      value: function convertToGlobal(t, e) {\n        if (e || (e = this.direction), null == t) return null;\n        var i = this.getRect();\n        return {\n          x: 0 === e ? t.x + i.left + i.width / 2 : i.width / 2 - t.x + i.left,\n          y: t.y + i.top\n        };\n      }\n    }, {\n      key: \"convertRectToGlobal\",\n      value: function convertRectToGlobal(t, e) {\n        return e || (e = this.direction), {\n          topLeft: this.convertToGlobal(t.topLeft, e),\n          topRight: this.convertToGlobal(t.topRight, e),\n          bottomLeft: this.convertToGlobal(t.bottomLeft, e),\n          bottomRight: this.convertToGlobal(t.bottomRight, e)\n        };\n      }\n    }]);\n    return l;\n  }();\n  var d = /*#__PURE__*/function (_l) {\n    _inherits(d, _l);\n    function d(t, e, i) {\n      var _this8;\n      _classCallCheck(this, d);\n      _this8 = _possibleConstructorReturn(this, _getPrototypeOf(d).call(this, t, e)), _this8.canvas = i, _this8.ctx = i.getContext(\"2d\");\n      return _this8;\n    }\n    _createClass(d, [{\n      key: \"getContext\",\n      value: function getContext() {\n        return this.ctx;\n      }\n    }, {\n      key: \"reload\",\n      value: function reload() {}\n    }, {\n      key: \"drawFrame\",\n      value: function drawFrame() {\n        this.clear(), \"portrait\" !== this.orientation && null != this.leftPage && this.leftPage.simpleDraw(0), null != this.rightPage && this.rightPage.simpleDraw(1), null != this.bottomPage && this.bottomPage.draw(), this.drawBookShadow(), null != this.flippingPage && this.flippingPage.draw(), null != this.shadow && (this.drawOuterShadow(), this.drawInnerShadow());\n        var t = this.getRect();\n        \"portrait\" === this.orientation && (this.ctx.beginPath(), this.ctx.rect(t.left + t.pageWidth, t.top, t.width, t.height), this.ctx.clip());\n      }\n    }, {\n      key: \"drawBookShadow\",\n      value: function drawBookShadow() {\n        var t = this.getRect();\n        this.ctx.save(), this.ctx.beginPath();\n        var e = t.width / 20;\n        this.ctx.rect(t.left, t.top, t.width, t.height);\n        var i = {\n          x: t.left + t.width / 2 - e / 2,\n          y: 0\n        };\n        this.ctx.translate(i.x, i.y);\n        var s = this.ctx.createLinearGradient(0, 0, e, 0);\n        s.addColorStop(0, \"rgba(0, 0, 0, 0)\"), s.addColorStop(.4, \"rgba(0, 0, 0, 0.2)\"), s.addColorStop(.49, \"rgba(0, 0, 0, 0.1)\"), s.addColorStop(.5, \"rgba(0, 0, 0, 0.5)\"), s.addColorStop(.51, \"rgba(0, 0, 0, 0.4)\"), s.addColorStop(1, \"rgba(0, 0, 0, 0)\"), this.ctx.clip(), this.ctx.fillStyle = s, this.ctx.fillRect(0, 0, e, 2 * t.height), this.ctx.restore();\n      }\n    }, {\n      key: \"drawOuterShadow\",\n      value: function drawOuterShadow() {\n        var t = this.getRect();\n        this.ctx.save(), this.ctx.beginPath(), this.ctx.rect(t.left, t.top, t.width, t.height);\n        var e = this.convertToGlobal({\n          x: this.shadow.pos.x,\n          y: this.shadow.pos.y\n        });\n        this.ctx.translate(e.x, e.y), this.ctx.rotate(Math.PI + this.shadow.angle + Math.PI / 2);\n        var i = this.ctx.createLinearGradient(0, 0, this.shadow.width, 0);\n        0 === this.shadow.direction ? (this.ctx.translate(0, -100), i.addColorStop(0, \"rgba(0, 0, 0, \" + this.shadow.opacity + \")\"), i.addColorStop(1, \"rgba(0, 0, 0, 0)\")) : (this.ctx.translate(-this.shadow.width, -100), i.addColorStop(0, \"rgba(0, 0, 0, 0)\"), i.addColorStop(1, \"rgba(0, 0, 0, \" + this.shadow.opacity + \")\")), this.ctx.clip(), this.ctx.fillStyle = i, this.ctx.fillRect(0, 0, this.shadow.width, 2 * t.height), this.ctx.restore();\n      }\n    }, {\n      key: \"drawInnerShadow\",\n      value: function drawInnerShadow() {\n        var t = this.getRect();\n        this.ctx.save(), this.ctx.beginPath();\n        var e = this.convertToGlobal({\n            x: this.shadow.pos.x,\n            y: this.shadow.pos.y\n          }),\n          i = this.convertRectToGlobal(this.pageRect);\n        this.ctx.moveTo(i.topLeft.x, i.topLeft.y), this.ctx.lineTo(i.topRight.x, i.topRight.y), this.ctx.lineTo(i.bottomRight.x, i.bottomRight.y), this.ctx.lineTo(i.bottomLeft.x, i.bottomLeft.y), this.ctx.translate(e.x, e.y), this.ctx.rotate(Math.PI + this.shadow.angle + Math.PI / 2);\n        var s = 3 * this.shadow.width / 4,\n          n = this.ctx.createLinearGradient(0, 0, s, 0);\n        0 === this.shadow.direction ? (this.ctx.translate(-s, -100), n.addColorStop(1, \"rgba(0, 0, 0, \" + this.shadow.opacity + \")\"), n.addColorStop(.9, \"rgba(0, 0, 0, 0.05)\"), n.addColorStop(.7, \"rgba(0, 0, 0, \" + this.shadow.opacity + \")\"), n.addColorStop(0, \"rgba(0, 0, 0, 0)\")) : (this.ctx.translate(0, -100), n.addColorStop(0, \"rgba(0, 0, 0, \" + this.shadow.opacity + \")\"), n.addColorStop(.1, \"rgba(0, 0, 0, 0.05)\"), n.addColorStop(.3, \"rgba(0, 0, 0, \" + this.shadow.opacity + \")\"), n.addColorStop(1, \"rgba(0, 0, 0, 0)\")), this.ctx.clip(), this.ctx.fillStyle = n, this.ctx.fillRect(0, 0, s, 2 * t.height), this.ctx.restore();\n      }\n    }, {\n      key: \"clear\",\n      value: function clear() {\n        this.ctx.fillStyle = \"white\", this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n      }\n    }]);\n    return d;\n  }(l);\n  var p = /*#__PURE__*/function () {\n    function p(t, e, i) {\n      var _this9 = this;\n      _classCallCheck(this, p);\n      this.touchPoint = null, this.swipeTimeout = 250, this.onResize = function () {\n        _this9.update();\n      }, this.onMouseDown = function (t) {\n        if (_this9.checkTarget(t.target)) {\n          var _e10 = _this9.getMousePos(t.clientX, t.clientY);\n          _this9.app.startUserTouch(_e10), t.preventDefault();\n        }\n      }, this.onTouchStart = function (t) {\n        if (_this9.checkTarget(t.target) && t.changedTouches.length > 0) {\n          var _e11 = t.changedTouches[0],\n            _i6 = _this9.getMousePos(_e11.clientX, _e11.clientY);\n          _this9.touchPoint = {\n            point: _i6,\n            time: Date.now()\n          }, setTimeout(function () {\n            null !== _this9.touchPoint && _this9.app.startUserTouch(_i6);\n          }, _this9.swipeTimeout), _this9.app.getSettings().mobileScrollSupport || t.preventDefault();\n        }\n      }, this.onMouseUp = function (t) {\n        var e = _this9.getMousePos(t.clientX, t.clientY);\n        _this9.app.userStop(e);\n      }, this.onMouseMove = function (t) {\n        var e = _this9.getMousePos(t.clientX, t.clientY);\n        _this9.app.userMove(e, !1);\n      }, this.onTouchMove = function (t) {\n        if (t.changedTouches.length > 0) {\n          var _e12 = t.changedTouches[0],\n            _i7 = _this9.getMousePos(_e12.clientX, _e12.clientY);\n          _this9.app.getSettings().mobileScrollSupport ? (null !== _this9.touchPoint && (Math.abs(_this9.touchPoint.point.x - _i7.x) > 10 || \"read\" !== _this9.app.getState()) && t.cancelable && _this9.app.userMove(_i7, !0), \"read\" !== _this9.app.getState() && t.preventDefault()) : _this9.app.userMove(_i7, !0);\n        }\n      }, this.onTouchEnd = function (t) {\n        if (t.changedTouches.length > 0) {\n          var _e13 = t.changedTouches[0],\n            _i8 = _this9.getMousePos(_e13.clientX, _e13.clientY);\n          var _s4 = !1;\n          if (null !== _this9.touchPoint) {\n            var _t11 = _i8.x - _this9.touchPoint.point.x,\n              _e14 = Math.abs(_i8.y - _this9.touchPoint.point.y);\n            Math.abs(_t11) > _this9.swipeDistance && _e14 < 2 * _this9.swipeDistance && Date.now() - _this9.touchPoint.time < _this9.swipeTimeout && (_t11 > 0 ? _this9.app.flipPrev(_this9.touchPoint.point.y < _this9.app.getRender().getRect().height / 2 ? \"top\" : \"bottom\") : _this9.app.flipNext(_this9.touchPoint.point.y < _this9.app.getRender().getRect().height / 2 ? \"top\" : \"bottom\"), _s4 = !0), _this9.touchPoint = null;\n          }\n          _this9.app.userStop(_i8, _s4);\n        }\n      }, this.parentElement = t, t.classList.add(\"stf__parent\"), t.insertAdjacentHTML(\"afterbegin\", '<div class=\"stf__wrapper\"></div>'), this.wrapper = t.querySelector(\".stf__wrapper\"), this.app = e;\n      var s = this.app.getSettings().usePortrait ? 1 : 2;\n      t.style.minWidth = i.minWidth * s + \"px\", t.style.minHeight = i.minHeight + \"px\", \"fixed\" === i.size && (t.style.minWidth = i.width * s + \"px\", t.style.minHeight = i.height + \"px\"), i.autoSize && (t.style.width = \"100%\", t.style.maxWidth = 2 * i.maxWidth + \"px\"), t.style.display = \"block\", window.addEventListener(\"resize\", this.onResize, !1), this.swipeDistance = i.swipeDistance;\n    }\n    _createClass(p, [{\n      key: \"destroy\",\n      value: function destroy() {\n        this.app.getSettings().useMouseEvents && this.removeHandlers(), this.distElement.remove(), this.wrapper.remove();\n      }\n    }, {\n      key: \"getDistElement\",\n      value: function getDistElement() {\n        return this.distElement;\n      }\n    }, {\n      key: \"getWrapper\",\n      value: function getWrapper() {\n        return this.wrapper;\n      }\n    }, {\n      key: \"setOrientationStyle\",\n      value: function setOrientationStyle(t) {\n        this.wrapper.classList.remove(\"--portrait\", \"--landscape\"), \"portrait\" === t ? (this.app.getSettings().autoSize && (this.wrapper.style.paddingBottom = this.app.getSettings().height / this.app.getSettings().width * 100 + \"%\"), this.wrapper.classList.add(\"--portrait\")) : (this.app.getSettings().autoSize && (this.wrapper.style.paddingBottom = this.app.getSettings().height / (2 * this.app.getSettings().width) * 100 + \"%\"), this.wrapper.classList.add(\"--landscape\")), this.update();\n      }\n    }, {\n      key: \"removeHandlers\",\n      value: function removeHandlers() {\n        window.removeEventListener(\"resize\", this.onResize), this.distElement.removeEventListener(\"mousedown\", this.onMouseDown), this.distElement.removeEventListener(\"touchstart\", this.onTouchStart), window.removeEventListener(\"mousemove\", this.onMouseMove), window.removeEventListener(\"touchmove\", this.onTouchMove), window.removeEventListener(\"mouseup\", this.onMouseUp), window.removeEventListener(\"touchend\", this.onTouchEnd);\n      }\n    }, {\n      key: \"setHandlers\",\n      value: function setHandlers() {\n        window.addEventListener(\"resize\", this.onResize, !1), this.app.getSettings().useMouseEvents && (this.distElement.addEventListener(\"mousedown\", this.onMouseDown), this.distElement.addEventListener(\"touchstart\", this.onTouchStart), window.addEventListener(\"mousemove\", this.onMouseMove), window.addEventListener(\"touchmove\", this.onTouchMove, {\n          passive: !this.app.getSettings().mobileScrollSupport\n        }), window.addEventListener(\"mouseup\", this.onMouseUp), window.addEventListener(\"touchend\", this.onTouchEnd));\n      }\n    }, {\n      key: \"getMousePos\",\n      value: function getMousePos(t, e) {\n        var i = this.distElement.getBoundingClientRect();\n        return {\n          x: t - i.left,\n          y: e - i.top\n        };\n      }\n    }, {\n      key: \"checkTarget\",\n      value: function checkTarget(t) {\n        return !this.app.getSettings().clickEventForward || ![\"a\", \"button\"].includes(t.tagName.toLowerCase());\n      }\n    }]);\n    return p;\n  }();\n  var c = /*#__PURE__*/function (_p) {\n    _inherits(c, _p);\n    function c(t, e, i, s) {\n      var _this10;\n      _classCallCheck(this, c);\n      _this10 = _possibleConstructorReturn(this, _getPrototypeOf(c).call(this, t, e, i)), _this10.wrapper.insertAdjacentHTML(\"afterbegin\", '<div class=\"stf__block\"></div>'), _this10.distElement = t.querySelector(\".stf__block\"), _this10.items = s;\n      var _iterator6 = _createForOfIteratorHelper(s),\n        _step6;\n      try {\n        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n          var _t12 = _step6.value;\n          _this10.distElement.appendChild(_t12);\n        }\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n      _this10.setHandlers();\n      return _this10;\n    }\n    _createClass(c, [{\n      key: \"clear\",\n      value: function clear() {\n        var _iterator7 = _createForOfIteratorHelper(this.items),\n          _step7;\n        try {\n          for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n            var _t13 = _step7.value;\n            this.parentElement.appendChild(_t13);\n          }\n        } catch (err) {\n          _iterator7.e(err);\n        } finally {\n          _iterator7.f();\n        }\n      }\n    }, {\n      key: \"updateItems\",\n      value: function updateItems(t) {\n        this.removeHandlers(), this.distElement.innerHTML = \"\";\n        var _iterator8 = _createForOfIteratorHelper(t),\n          _step8;\n        try {\n          for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n            var _e15 = _step8.value;\n            this.distElement.appendChild(_e15);\n          }\n        } catch (err) {\n          _iterator8.e(err);\n        } finally {\n          _iterator8.f();\n        }\n        this.items = t, this.setHandlers();\n      }\n    }, {\n      key: \"update\",\n      value: function update() {\n        this.app.getRender().update();\n      }\n    }]);\n    return c;\n  }(p);\n  var u = /*#__PURE__*/function (_p2) {\n    _inherits(u, _p2);\n    function u(t, e, i) {\n      var _this11;\n      _classCallCheck(this, u);\n      _this11 = _possibleConstructorReturn(this, _getPrototypeOf(u).call(this, t, e, i)), _this11.wrapper.innerHTML = '<canvas class=\"stf__canvas\"></canvas>', _this11.canvas = t.querySelectorAll(\"canvas\")[0], _this11.distElement = _this11.canvas, _this11.resizeCanvas(), _this11.setHandlers();\n      return _this11;\n    }\n    _createClass(u, [{\n      key: \"resizeCanvas\",\n      value: function resizeCanvas() {\n        var t = getComputedStyle(this.canvas),\n          e = parseInt(t.getPropertyValue(\"width\"), 10),\n          i = parseInt(t.getPropertyValue(\"height\"), 10);\n        this.canvas.width = e, this.canvas.height = i;\n      }\n    }, {\n      key: \"getCanvas\",\n      value: function getCanvas() {\n        return this.canvas;\n      }\n    }, {\n      key: \"update\",\n      value: function update() {\n        this.resizeCanvas(), this.app.getRender().update();\n      }\n    }]);\n    return u;\n  }(p);\n  var w = /*#__PURE__*/function (_l2) {\n    _inherits(w, _l2);\n    function w(t, e, i) {\n      var _this12;\n      _classCallCheck(this, w);\n      _this12 = _possibleConstructorReturn(this, _getPrototypeOf(w).call(this, t, e)), _this12.outerShadow = null, _this12.innerShadow = null, _this12.hardShadow = null, _this12.hardInnerShadow = null, _this12.element = i, _this12.createShadows();\n      return _this12;\n    }\n    _createClass(w, [{\n      key: \"createShadows\",\n      value: function createShadows() {\n        this.element.insertAdjacentHTML(\"beforeend\", '<div class=\"stf__outerShadow\"></div>\\n             <div class=\"stf__innerShadow\"></div>\\n             <div class=\"stf__hardShadow\"></div>\\n             <div class=\"stf__hardInnerShadow\"></div>'), this.outerShadow = this.element.querySelector(\".stf__outerShadow\"), this.innerShadow = this.element.querySelector(\".stf__innerShadow\"), this.hardShadow = this.element.querySelector(\".stf__hardShadow\"), this.hardInnerShadow = this.element.querySelector(\".stf__hardInnerShadow\");\n      }\n    }, {\n      key: \"clearShadow\",\n      value: function clearShadow() {\n        _get(_getPrototypeOf(w.prototype), \"clearShadow\", this).call(this), this.outerShadow.style.cssText = \"display: none\", this.innerShadow.style.cssText = \"display: none\", this.hardShadow.style.cssText = \"display: none\", this.hardInnerShadow.style.cssText = \"display: none\";\n      }\n    }, {\n      key: \"reload\",\n      value: function reload() {\n        this.element.querySelector(\".stf__outerShadow\") || this.createShadows();\n      }\n    }, {\n      key: \"drawHardInnerShadow\",\n      value: function drawHardInnerShadow() {\n        var t = this.getRect(),\n          e = this.shadow.progress > 100 ? 200 - this.shadow.progress : this.shadow.progress;\n        var i = (100 - e) * (2.5 * t.pageWidth) / 100 + 20;\n        i > t.pageWidth && (i = t.pageWidth);\n        var s = \"\\n            display: block;\\n            z-index: \".concat((this.getSettings().startZIndex + 5).toString(10), \";\\n            width: \").concat(i, \"px;\\n            height: \").concat(t.height, \"px;\\n            background: linear-gradient(to right,\\n                rgba(0, 0, 0, \").concat(this.shadow.opacity * e / 100, \") 5%,\\n                rgba(0, 0, 0, 0) 100%);\\n            left: \").concat(t.left + t.width / 2, \"px;\\n            transform-origin: 0 0;\\n        \");\n        s += 0 === this.getDirection() && this.shadow.progress > 100 || 1 === this.getDirection() && this.shadow.progress <= 100 ? \"transform: translate3d(0, 0, 0);\" : \"transform: translate3d(0, 0, 0) rotateY(180deg);\", this.hardInnerShadow.style.cssText = s;\n      }\n    }, {\n      key: \"drawHardOuterShadow\",\n      value: function drawHardOuterShadow() {\n        var t = this.getRect();\n        var e = (100 - (this.shadow.progress > 100 ? 200 - this.shadow.progress : this.shadow.progress)) * (2.5 * t.pageWidth) / 100 + 20;\n        e > t.pageWidth && (e = t.pageWidth);\n        var i = \"\\n            display: block;\\n            z-index: \".concat((this.getSettings().startZIndex + 4).toString(10), \";\\n            width: \").concat(e, \"px;\\n            height: \").concat(t.height, \"px;\\n            background: linear-gradient(to left, rgba(0, 0, 0, \").concat(this.shadow.opacity, \") 5%, rgba(0, 0, 0, 0) 100%);\\n            left: \").concat(t.left + t.width / 2, \"px;\\n            transform-origin: 0 0;\\n        \");\n        i += 0 === this.getDirection() && this.shadow.progress > 100 || 1 === this.getDirection() && this.shadow.progress <= 100 ? \"transform: translate3d(0, 0, 0) rotateY(180deg);\" : \"transform: translate3d(0, 0, 0);\", this.hardShadow.style.cssText = i;\n      }\n    }, {\n      key: \"drawInnerShadow\",\n      value: function drawInnerShadow() {\n        var t = this.getRect(),\n          e = 3 * this.shadow.width / 4,\n          i = 0 === this.getDirection() ? e : 0,\n          s = 0 === this.getDirection() ? \"to left\" : \"to right\",\n          n = this.convertToGlobal(this.shadow.pos),\n          r = this.shadow.angle + 3 * Math.PI / 2,\n          o = [this.pageRect.topLeft, this.pageRect.topRight, this.pageRect.bottomRight, this.pageRect.bottomLeft];\n        var a = \"polygon( \";\n        for (var _i9 = 0, _o2 = o; _i9 < _o2.length; _i9++) {\n          var _t14 = _o2[_i9];\n          var _e16 = 1 === this.getDirection() ? {\n            x: -_t14.x + this.shadow.pos.x,\n            y: _t14.y - this.shadow.pos.y\n          } : {\n            x: _t14.x - this.shadow.pos.x,\n            y: _t14.y - this.shadow.pos.y\n          };\n          _e16 = h.GetRotatedPoint(_e16, {\n            x: i,\n            y: 100\n          }, r), a += _e16.x + \"px \" + _e16.y + \"px, \";\n        }\n        a = a.slice(0, -2), a += \")\";\n        var g = \"\\n            display: block;\\n            z-index: \".concat((this.getSettings().startZIndex + 10).toString(10), \";\\n            width: \").concat(e, \"px;\\n            height: \").concat(2 * t.height, \"px;\\n            background: linear-gradient(\").concat(s, \",\\n                rgba(0, 0, 0, \").concat(this.shadow.opacity, \") 5%,\\n                rgba(0, 0, 0, 0.05) 15%,\\n                rgba(0, 0, 0, \").concat(this.shadow.opacity, \") 35%,\\n                rgba(0, 0, 0, 0) 100%);\\n            transform-origin: \").concat(i, \"px 100px;\\n            transform: translate3d(\").concat(n.x - i, \"px, \").concat(n.y - 100, \"px, 0) rotate(\").concat(r, \"rad);\\n            clip-path: \").concat(a, \";\\n            -webkit-clip-path: \").concat(a, \";\\n        \");\n        this.innerShadow.style.cssText = g;\n      }\n    }, {\n      key: \"drawOuterShadow\",\n      value: function drawOuterShadow() {\n        var t = this.getRect(),\n          e = this.convertToGlobal({\n            x: this.shadow.pos.x,\n            y: this.shadow.pos.y\n          }),\n          i = this.shadow.angle + 3 * Math.PI / 2,\n          s = 1 === this.getDirection() ? this.shadow.width : 0,\n          n = 0 === this.getDirection() ? \"to right\" : \"to left\",\n          r = [{\n            x: 0,\n            y: 0\n          }, {\n            x: t.pageWidth,\n            y: 0\n          }, {\n            x: t.pageWidth,\n            y: t.height\n          }, {\n            x: 0,\n            y: t.height\n          }];\n        var o = \"polygon( \";\n        for (var _i10 = 0, _r = r; _i10 < _r.length; _i10++) {\n          var _t15 = _r[_i10];\n          if (null !== _t15) {\n            var _e17 = 1 === this.getDirection() ? {\n              x: -_t15.x + this.shadow.pos.x,\n              y: _t15.y - this.shadow.pos.y\n            } : {\n              x: _t15.x - this.shadow.pos.x,\n              y: _t15.y - this.shadow.pos.y\n            };\n            _e17 = h.GetRotatedPoint(_e17, {\n              x: s,\n              y: 100\n            }, i), o += _e17.x + \"px \" + _e17.y + \"px, \";\n          }\n        }\n        o = o.slice(0, -2), o += \")\";\n        var a = \"\\n            display: block;\\n            z-index: \".concat((this.getSettings().startZIndex + 10).toString(10), \";\\n            width: \").concat(this.shadow.width, \"px;\\n            height: \").concat(2 * t.height, \"px;\\n            background: linear-gradient(\").concat(n, \", rgba(0, 0, 0, \").concat(this.shadow.opacity, \"), rgba(0, 0, 0, 0));\\n            transform-origin: \").concat(s, \"px 100px;\\n            transform: translate3d(\").concat(e.x - s, \"px, \").concat(e.y - 100, \"px, 0) rotate(\").concat(i, \"rad);\\n            clip-path: \").concat(o, \";\\n            -webkit-clip-path: \").concat(o, \";\\n        \");\n        this.outerShadow.style.cssText = a;\n      }\n    }, {\n      key: \"drawLeftPage\",\n      value: function drawLeftPage() {\n        \"portrait\" !== this.orientation && null !== this.leftPage && (1 === this.direction && null !== this.flippingPage && \"hard\" === this.flippingPage.getDrawingDensity() ? (this.leftPage.getElement().style.zIndex = (this.getSettings().startZIndex + 5).toString(10), this.leftPage.setHardDrawingAngle(180 + this.flippingPage.getHardAngle()), this.leftPage.draw(this.flippingPage.getDrawingDensity())) : this.leftPage.simpleDraw(0));\n      }\n    }, {\n      key: \"drawRightPage\",\n      value: function drawRightPage() {\n        null !== this.rightPage && (0 === this.direction && null !== this.flippingPage && \"hard\" === this.flippingPage.getDrawingDensity() ? (this.rightPage.getElement().style.zIndex = (this.getSettings().startZIndex + 5).toString(10), this.rightPage.setHardDrawingAngle(180 + this.flippingPage.getHardAngle()), this.rightPage.draw(this.flippingPage.getDrawingDensity())) : this.rightPage.simpleDraw(1));\n      }\n    }, {\n      key: \"drawBottomPage\",\n      value: function drawBottomPage() {\n        if (null === this.bottomPage) return;\n        var t = null != this.flippingPage ? this.flippingPage.getDrawingDensity() : null;\n        \"portrait\" === this.orientation && 1 === this.direction || (this.bottomPage.getElement().style.zIndex = (this.getSettings().startZIndex + 3).toString(10), this.bottomPage.draw(t));\n      }\n    }, {\n      key: \"drawFrame\",\n      value: function drawFrame() {\n        this.clear(), this.drawLeftPage(), this.drawRightPage(), this.drawBottomPage(), null != this.flippingPage && (this.flippingPage.getElement().style.zIndex = (this.getSettings().startZIndex + 5).toString(10), this.flippingPage.draw()), null != this.shadow && null !== this.flippingPage && (\"soft\" === this.flippingPage.getDrawingDensity() ? (this.drawOuterShadow(), this.drawInnerShadow()) : (this.drawHardOuterShadow(), this.drawHardInnerShadow()));\n      }\n    }, {\n      key: \"clear\",\n      value: function clear() {\n        var _iterator9 = _createForOfIteratorHelper(this.app.getPageCollection().getPages()),\n          _step9;\n        try {\n          for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n            var _t16 = _step9.value;\n            _t16 !== this.leftPage && _t16 !== this.rightPage && _t16 !== this.flippingPage && _t16 !== this.bottomPage && (_t16.getElement().style.cssText = \"display: none\"), _t16.getTemporaryCopy() !== this.flippingPage && _t16.hideTemporaryCopy();\n          }\n        } catch (err) {\n          _iterator9.e(err);\n        } finally {\n          _iterator9.f();\n        }\n      }\n    }, {\n      key: \"update\",\n      value: function update() {\n        _get(_getPrototypeOf(w.prototype), \"update\", this).call(this), null !== this.rightPage && this.rightPage.setOrientation(1), null !== this.leftPage && this.leftPage.setOrientation(0);\n      }\n    }]);\n    return w;\n  }(l);\n  var x = /*#__PURE__*/function () {\n    function x() {\n      _classCallCheck(this, x);\n      this._default = {\n        startPage: 0,\n        size: \"fixed\",\n        width: 0,\n        height: 0,\n        minWidth: 0,\n        maxWidth: 0,\n        minHeight: 0,\n        maxHeight: 0,\n        drawShadow: !0,\n        flippingTime: 1e3,\n        usePortrait: !0,\n        startZIndex: 0,\n        autoSize: !0,\n        maxShadowOpacity: 1,\n        showCover: !1,\n        mobileScrollSupport: !0,\n        swipeDistance: 30,\n        clickEventForward: !0,\n        useMouseEvents: !0,\n        showPageCorners: !0,\n        disableFlipByClick: !1\n      };\n    }\n    _createClass(x, [{\n      key: \"getSettings\",\n      value: function getSettings(t) {\n        var e = this._default;\n        if (Object.assign(e, t), \"stretch\" !== e.size && \"fixed\" !== e.size) throw new Error('Invalid size type. Available only \"fixed\" and \"stretch\" value');\n        if (e.width <= 0 || e.height <= 0) throw new Error(\"Invalid width or height\");\n        if (e.flippingTime <= 0) throw new Error(\"Invalid flipping time\");\n        return \"stretch\" === e.size ? (e.minWidth <= 0 && (e.minWidth = 100), e.maxWidth < e.minWidth && (e.maxWidth = 2e3), e.minHeight <= 0 && (e.minHeight = 100), e.maxHeight < e.minHeight && (e.maxHeight = 2e3)) : (e.minWidth = e.width, e.maxWidth = e.width, e.minHeight = e.height, e.maxHeight = e.height), e;\n      }\n    }]);\n    return x;\n  }();\n  !function (t, e) {\n    void 0 === e && (e = {});\n    var i = e.insertAt;\n    if (t && \"undefined\" != typeof document) {\n      var s = document.head || document.getElementsByTagName(\"head\")[0],\n        n = document.createElement(\"style\");\n      n.type = \"text/css\", \"top\" === i && s.firstChild ? s.insertBefore(n, s.firstChild) : s.appendChild(n), n.styleSheet ? n.styleSheet.cssText = t : n.appendChild(document.createTextNode(t));\n    }\n  }(\".stf__parent {\\n  position: relative;\\n  display: block;\\n  box-sizing: border-box;\\n  transform: translateZ(0);\\n\\n  -ms-touch-action: pan-y;\\n  touch-action: pan-y;\\n}\\n\\n.sft__wrapper {\\n  position: relative;\\n  width: 100%;\\n  box-sizing: border-box;\\n}\\n\\n.stf__parent canvas {\\n  position: absolute;\\n  width: 100%;\\n  height: 100%;\\n  left: 0;\\n  top: 0;\\n}\\n\\n.stf__block {\\n  position: absolute;\\n  width: 100%;\\n  height: 100%;\\n  box-sizing: border-box;\\n  perspective: 2000px;\\n}\\n\\n.stf__item {\\n  display: none;\\n  position: absolute;\\n  transform-style: preserve-3d;\\n}\\n\\n.stf__outerShadow {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n}\\n\\n.stf__innerShadow {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n}\\n\\n.stf__hardShadow {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n}\\n\\n.stf__hardInnerShadow {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n}\");\n  t.PageFlip = /*#__PURE__*/function (_ref) {\n    _inherits(_class, _ref);\n    function _class(t, e) {\n      var _this13;\n      _classCallCheck(this, _class);\n      _this13 = _possibleConstructorReturn(this, _getPrototypeOf(_class).call(this)), _this13.isUserTouch = !1, _this13.isUserMove = !1, _this13.setting = null, _this13.pages = null, _this13.setting = new x().getSettings(e), _this13.block = t;\n      return _this13;\n    }\n    _createClass(_class, [{\n      key: \"destroy\",\n      value: function destroy() {\n        this.ui.destroy(), this.block.remove();\n      }\n    }, {\n      key: \"update\",\n      value: function update() {\n        this.render.update(), this.pages.show();\n      }\n    }, {\n      key: \"loadFromImages\",\n      value: function loadFromImages(t) {\n        var _this14 = this;\n        this.ui = new u(this.block, this, this.setting);\n        var e = this.ui.getCanvas();\n        this.render = new d(this, this.setting, e), this.flipController = new g(this.render, this), this.pages = new n(this, this.render, t), this.pages.load(), this.render.start(), this.pages.show(this.setting.startPage), setTimeout(function () {\n          _this14.ui.update(), _this14.trigger(\"init\", _this14, {\n            page: _this14.setting.startPage,\n            mode: _this14.render.getOrientation()\n          });\n        }, 1);\n      }\n    }, {\n      key: \"loadFromHTML\",\n      value: function loadFromHTML(t) {\n        var _this15 = this;\n        this.ui = new c(this.block, this, this.setting, t), this.render = new w(this, this.setting, this.ui.getDistElement()), this.flipController = new g(this.render, this), this.pages = new o(this, this.render, this.ui.getDistElement(), t), this.pages.load(), this.render.start(), this.pages.show(this.setting.startPage), setTimeout(function () {\n          _this15.ui.update(), _this15.trigger(\"init\", _this15, {\n            page: _this15.setting.startPage,\n            mode: _this15.render.getOrientation()\n          });\n        }, 1);\n      }\n    }, {\n      key: \"updateFromImages\",\n      value: function updateFromImages(t) {\n        var e = this.pages.getCurrentPageIndex();\n        this.pages.destroy(), this.pages = new n(this, this.render, t), this.pages.load(), this.pages.show(e), this.trigger(\"update\", this, {\n          page: e,\n          mode: this.render.getOrientation()\n        });\n      }\n    }, {\n      key: \"updateFromHtml\",\n      value: function updateFromHtml(t) {\n        var e = this.pages.getCurrentPageIndex();\n        this.pages.destroy(), this.pages = new o(this, this.render, this.ui.getDistElement(), t), this.pages.load(), this.ui.updateItems(t), this.render.reload(), this.pages.show(e), this.trigger(\"update\", this, {\n          page: e,\n          mode: this.render.getOrientation()\n        });\n      }\n    }, {\n      key: \"clear\",\n      value: function clear() {\n        this.pages.destroy(), this.ui.clear();\n      }\n    }, {\n      key: \"turnToPrevPage\",\n      value: function turnToPrevPage() {\n        this.pages.showPrev();\n      }\n    }, {\n      key: \"turnToNextPage\",\n      value: function turnToNextPage() {\n        this.pages.showNext();\n      }\n    }, {\n      key: \"turnToPage\",\n      value: function turnToPage(t) {\n        this.pages.show(t);\n      }\n    }, {\n      key: \"flipNext\",\n      value: function flipNext() {\n        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"top\";\n        this.flipController.flipNext(t);\n      }\n    }, {\n      key: \"flipPrev\",\n      value: function flipPrev() {\n        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"top\";\n        this.flipController.flipPrev(t);\n      }\n    }, {\n      key: \"flip\",\n      value: function flip(t) {\n        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"top\";\n        this.flipController.flipToPage(t, e);\n      }\n    }, {\n      key: \"updateState\",\n      value: function updateState(t) {\n        this.trigger(\"changeState\", this, t);\n      }\n    }, {\n      key: \"updatePageIndex\",\n      value: function updatePageIndex(t) {\n        this.trigger(\"flip\", this, t);\n      }\n    }, {\n      key: \"updateOrientation\",\n      value: function updateOrientation(t) {\n        this.ui.setOrientationStyle(t), this.update(), this.trigger(\"changeOrientation\", this, t);\n      }\n    }, {\n      key: \"getPageCount\",\n      value: function getPageCount() {\n        return this.pages.getPageCount();\n      }\n    }, {\n      key: \"getCurrentPageIndex\",\n      value: function getCurrentPageIndex() {\n        return this.pages.getCurrentPageIndex();\n      }\n    }, {\n      key: \"getPage\",\n      value: function getPage(t) {\n        return this.pages.getPage(t);\n      }\n    }, {\n      key: \"getRender\",\n      value: function getRender() {\n        return this.render;\n      }\n    }, {\n      key: \"getFlipController\",\n      value: function getFlipController() {\n        return this.flipController;\n      }\n    }, {\n      key: \"getOrientation\",\n      value: function getOrientation() {\n        return this.render.getOrientation();\n      }\n    }, {\n      key: \"getBoundsRect\",\n      value: function getBoundsRect() {\n        return this.render.getRect();\n      }\n    }, {\n      key: \"getSettings\",\n      value: function getSettings() {\n        return this.setting;\n      }\n    }, {\n      key: \"getUI\",\n      value: function getUI() {\n        return this.ui;\n      }\n    }, {\n      key: \"getState\",\n      value: function getState() {\n        return this.flipController.getState();\n      }\n    }, {\n      key: \"getPageCollection\",\n      value: function getPageCollection() {\n        return this.pages;\n      }\n    }, {\n      key: \"startUserTouch\",\n      value: function startUserTouch(t) {\n        this.mousePosition = t, this.isUserTouch = !0, this.isUserMove = !1;\n      }\n    }, {\n      key: \"userMove\",\n      value: function userMove(t, e) {\n        this.isUserTouch || e || !this.setting.showPageCorners ? this.isUserTouch && h.GetDistanceBetweenTwoPoint(this.mousePosition, t) > 5 && (this.isUserMove = !0, this.flipController.fold(t)) : this.flipController.showCorner(t);\n      }\n    }, {\n      key: \"userStop\",\n      value: function userStop(t) {\n        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n        this.isUserTouch && (this.isUserTouch = !1, e || (this.isUserMove ? this.flipController.stopMove() : this.flipController.flip(t)));\n      }\n    }]);\n    return _class;\n  }( /*#__PURE__*/function () {\n    function _class2() {\n      _classCallCheck(this, _class2);\n      this.events = new Map();\n    }\n    _createClass(_class2, [{\n      key: \"on\",\n      value: function on(t, e) {\n        return this.events.has(t) ? this.events.get(t).push(e) : this.events.set(t, [e]), this;\n      }\n    }, {\n      key: \"off\",\n      value: function off(t) {\n        this.events.delete(t);\n      }\n    }, {\n      key: \"trigger\",\n      value: function trigger(t, e) {\n        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n        if (this.events.has(t)) {\n          var _iterator10 = _createForOfIteratorHelper(this.events.get(t)),\n            _step10;\n          try {\n            for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {\n              var _s5 = _step10.value;\n              _s5({\n                data: i,\n                object: e\n              });\n            }\n          } catch (err) {\n            _iterator10.e(err);\n          } finally {\n            _iterator10.f();\n          }\n        }\n      }\n    }]);\n    return _class2;\n  }()), Object.defineProperty(t, \"__esModule\", {\n    value: !0\n  });\n});","map":null,"metadata":{},"sourceType":"script"}